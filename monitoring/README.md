# E-commerce ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë° ëª¨ë‹ˆí„°ë§ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ ê°€ì´ë“œëŠ” HangHae Plus E-commerce Spring ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸ì™€ ëª¨ë‹ˆí„°ë§ í™˜ê²½ êµ¬ì„± ë° ì‚¬ìš©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ›  êµ¬ì„± ìš”ì†Œ

### ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬
- **k6**: JavaScript ê¸°ë°˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬
- 3ê°€ì§€ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤: Load Test, Stress Test, Peak Test

### ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ
- **Prometheus**: ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ì €ì¥
- **Grafana**: ë©”íŠ¸ë¦­ ì‹œê°í™” ëŒ€ì‹œë³´ë“œ
- **Spring Boot Actuator**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­ ë…¸ì¶œ

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1. ì „ì²´ í™˜ê²½ ì‹œì‘

```bash
# 1. ê¸°ë³¸ ì¸í”„ë¼ ì‹œì‘ (MySQL, Redis, Kafka)
docker-compose up -d

# 2. ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ ì‹œì‘
docker-compose --profile monitoring up -d

# 3. Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
./gradlew bootRun
```

### 2. ì ‘ì† URL

- **ì• í”Œë¦¬ì¼€ì´ì…˜**: http://localhost:8080
- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **Actuator Health**: http://localhost:8080/actuator/health
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/admin)

## ğŸ“Š ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

### Load Test (ê¸°ë³¸ ë¶€í•˜ í…ŒìŠ¤íŠ¸)
```bash
docker-compose --profile testing run --rm k6 run /scripts/load-test-basic.js
```
- **ëª©ì **: ì¼ë°˜ì ì¸ ë¶€í•˜ì—ì„œì˜ ì„±ëŠ¥ ì¸¡ì •
- **ì‹œë‚˜ë¦¬ì˜¤**: ì ì§„ì  ì‚¬ìš©ì ì¦ê°€ (10ëª… â†’ 20ëª…)
- **í…ŒìŠ¤íŠ¸ ë¹„ìœ¨**: ìƒí’ˆ ì¡°íšŒ(40%) + í¬ì¸íŠ¸ ì¶©ì „(30%) + ì£¼ë¬¸(20%) + ì¿ í°(10%)

### Stress Test (ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸)
```bash
docker-compose --profile testing run --rm k6 run /scripts/stress-test.js
```
- **ëª©ì **: ë†’ì€ ë¶€í•˜ì—ì„œì˜ ì‹œìŠ¤í…œ í•œê³„ ì¸¡ì •
- **ì‹œë‚˜ë¦¬ì˜¤**: 300ëª…ê¹Œì§€ ì‚¬ìš©ì ì¦ê°€
- **ì¤‘ì **: ë¶„ì‚° ë½ ì„±ëŠ¥, ì¬ê³  ê´€ë¦¬ ë™ì‹œì„±

### Peak Test (ìµœëŒ€ ë¶€í•˜ í…ŒìŠ¤íŠ¸)
```bash
docker-compose --profile testing run --rm k6 run /scripts/peak-test.js
```
- **ëª©ì **: ê°‘ì‘ìŠ¤ëŸ¬ìš´ íŠ¸ë˜í”½ ê¸‰ì¦ ìƒí™© ì‹œë®¬ë ˆì´ì…˜
- **ì‹œë‚˜ë¦¬ì˜¤**: í”Œë˜ì‹œ ì„¸ì¼, í•œì • ì¿ í° ë°œê¸‰
- **ê¸‰ì¦**: 10ëª… â†’ 200ëª… (10ì´ˆ ë‚´)

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§ ì„¤ì •

### Grafana ëŒ€ì‹œë³´ë“œ ì„¤ì •

1. **Grafana ì ‘ì†**: http://localhost:3000 (admin/admin)
2. **ë°ì´í„°ì†ŒìŠ¤ í™•ì¸**: Prometheusê°€ ìë™ìœ¼ë¡œ ì„¤ì •ë¨
3. **ëŒ€ì‹œë³´ë“œ ìƒì„±** ë˜ëŠ” ê¸°ì¡´ í…œí”Œë¦¿ ì‚¬ìš©

### ì£¼ìš” ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­

#### HTTP ìš”ì²­ ê´€ë ¨
```promql
# ì´ˆë‹¹ ìš”ì²­ ìˆ˜ (RPS)
rate(http_server_requests_seconds_count[1m])

# í‰ê·  ì‘ë‹µ ì‹œê°„
rate(http_server_requests_seconds_sum[1m]) / rate(http_server_requests_seconds_count[1m])

# 95% ì‘ë‹µ ì‹œê°„
histogram_quantile(0.95, rate(http_server_requests_seconds_bucket[1m]))

# ì—ëŸ¬ìœ¨
rate(http_server_requests_seconds_count{status=~"4..|5.."}[1m]) / rate(http_server_requests_seconds_count[1m])
```

#### JVM ë©”íŠ¸ë¦­
```promql
# í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ 
jvm_memory_used_bytes{area="heap"} / jvm_memory_max_bytes{area="heap"}

# GC íšŸìˆ˜
rate(jvm_gc_pause_seconds_count[1m])

# ìŠ¤ë ˆë“œ ìˆ˜
jvm_threads_live_threads
```

#### ì• í”Œë¦¬ì¼€ì´ì…˜ ë©”íŠ¸ë¦­
```promql
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€
hikaricp_connections_active
hikaricp_connections_idle

# ìºì‹œ íˆíŠ¸ìœ¨
cache_gets_total{result="hit"} / cache_gets_total
```

## ğŸ“‹ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë³„ ì£¼ì˜ì‚¬í•­

### Load Test
- **ëª©í‘œ**: ì •ìƒ ìš´ì˜ í™˜ê²½ì—ì„œì˜ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬
- **ì„±ê³µ ê¸°ì¤€**: 
  - 95% ì‘ë‹µì‹œê°„ < 500ms
  - ì—ëŸ¬ìœ¨ < 10%
  - ëª¨ë“  API ì •ìƒ ë™ì‘

### Stress Test  
- **ëª©í‘œ**: ì‹œìŠ¤í…œ í•œê³„ì  íŒŒì•…
- **ê´€ì°° í¬ì¸íŠ¸**:
  - ë¶„ì‚° ë½ ëŒ€ê¸° ì‹œê°„
  - ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ
  - ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€

### Peak Test
- **ëª©í‘œ**: ê°‘ì‘ìŠ¤ëŸ¬ìš´ íŠ¸ë˜í”½ ê¸‰ì¦ ëŒ€ì‘
- **ì‹œë‚˜ë¦¬ì˜¤**:
  - í”Œë˜ì‹œ ì„¸ì¼ (ë™ì¼ ìƒí’ˆ ì§‘ì¤‘ ì ‘ê·¼)
  - í•œì • ì¿ í° ë°œê¸‰ (ì„ ì°©ìˆœ ê²½ìŸ)
- **ê´€ì°° í¬ì¸íŠ¸**:
  - íì‰ ì‹œìŠ¤í…œ ë™ì‘
  - ì¥ì•  ì „íŒŒ ë°©ì§€

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

1. **Docker ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹¤íŒ¨**
   ```bash
   docker-compose down
   docker system prune -f
   docker-compose up -d
   ```

2. **k6 í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨**
   - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
   - `host.docker.internal` ì—°ê²° í™•ì¸

3. **Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì•ˆë¨**
   - Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ `/actuator/prometheus` ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
   - Prometheus ì„¤ì •ì˜ target ì£¼ì†Œ í™•ì¸

4. **Grafana ëŒ€ì‹œë³´ë“œ ë°ì´í„° ì—†ìŒ**
   - Prometheus ë°ì´í„°ì†ŒìŠ¤ ì—°ê²° ìƒíƒœ í™•ì¸
   - ì¿¼ë¦¬ ë¬¸ë²• í™•ì¸

### ë¡œê·¸ í™•ì¸
```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
./gradlew bootRun

# ì»¨í…Œì´ë„ˆ ë¡œê·¸
docker-compose logs prometheus
docker-compose logs grafana
docker-compose logs k6
```

## ğŸ“Š ê²°ê³¼ ë¶„ì„

### í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì¼
- **k6 ê²°ê³¼**: `./data/k6-results/` ë””ë ‰í„°ë¦¬
- **HTML ë¦¬í¬íŠ¸**: `summary.html`
- **JSON ë°ì´í„°**: `summary.json`

### ì£¼ìš” ë¶„ì„ ì§€í‘œ

1. **Performance**:
   - Average/95%/99% ì‘ë‹µ ì‹œê°„
   - Requests per second (RPS)
   - Throughput

2. **Reliability**:
   - Error rate
   - Success rate
   - Timeout ë°œìƒë¥ 

3. **Scalability**:
   - ì‚¬ìš©ì ì¦ê°€ì— ë”°ë¥¸ ì„±ëŠ¥ ë³€í™”
   - ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì¦ê°€ íŒ¨í„´

## ğŸ¯ ì„±ëŠ¥ ëª©í‘œ

### Chapter 4 ê³¼ì œ ê¸°ì¤€

- **TPS ëª©í‘œ**: APIë³„ ì ì ˆí•œ TPS ì„¤ì •
- **ì‘ë‹µì‹œê°„**: 95% ì‘ë‹µì‹œê°„ < 2ì´ˆ
- **ì—ëŸ¬ìœ¨**: < 5%
- **ê°€ìš©ì„±**: 99.9% ì´ìƒ

### ì‹œë‚˜ë¦¬ì˜¤ë³„ ê¸°ëŒ€ê°’

| í…ŒìŠ¤íŠ¸ ìœ í˜• | ì‚¬ìš©ì ìˆ˜ | TPS | ì‘ë‹µì‹œê°„(95%) | ì—ëŸ¬ìœ¨ |
|-------------|-----------|-----|---------------|--------|
| Load Test   | 20ëª…      | 50+ | < 500ms       | < 5%   |
| Stress Test | 200ëª…     | 100+| < 2s          | < 15%  |
| Peak Test   | 200ëª…     | 150+| < 3s          | < 20%  |

## ğŸ“ ë³´ê³ ì„œ ì‘ì„± ê°€ì´ë“œ

ê³¼ì œ ì œì¶œì„ ìœ„í•œ ë³´ê³ ì„œì—ëŠ” ë‹¤ìŒ ë‚´ìš©ì„ í¬í•¨í•˜ì„¸ìš”:

1. **í…ŒìŠ¤íŠ¸ ê³„íš**:
   - í…ŒìŠ¤íŠ¸ ëŒ€ìƒ API
   - ì‹œë‚˜ë¦¬ì˜¤ ì„¤ê³„ ê·¼ê±°
   - ì„±ëŠ¥ ëª©í‘œ ì„¤ì •

2. **ì‹¤í–‰ ê²°ê³¼**:
   - ê° í…ŒìŠ¤íŠ¸ë³„ ìƒì„¸ ê²°ê³¼
   - ê·¸ë˜í”„ ë° ì°¨íŠ¸
   - ë³‘ëª© ì§€ì  ë¶„ì„

3. **ë¬¸ì œì  ë° ê°œì„ ì‚¬í•­**:
   - ë°œê²¬ëœ ì„±ëŠ¥ ì´ìŠˆ
   - í•´ê²° ë°©ì•ˆ
   - ì½”ë“œ/ì„¤ì • ê°œì„ ì‚¬í•­

4. **ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤**:
   - ê°€ìƒ ì¥ì•  ìƒí™© ì •ì˜
   - ëŒ€ì‘ ë°©ì•ˆ
   - ëª¨ë‹ˆí„°ë§ ê°œì„ ì‚¬í•­