# 메세지 큐란?
메시지 큐는 분산된 환경에서 프로세스나 프로그램의 시스템간 데이터를 교환하기위해 
사용되는 통신기법입니다,

````mermaid
graph LR;
    A[Producer] -->|Message| B[Message Queue];
    B -->|Message| C[Consumer];

````

# 카프카란?
대규모 실시간 데이터 스트리밍을 위한 분산 메세징 시스템
카프카는 위와같은 메세지 큐의 한 종류라고 보면된다.


# 카프카의 구성요소
## 브로커
브로커는 카프카의 핵심요소로, 사실상 카프카 그 자체라고 보아도 무방하며
메시지를 저장하고 관리하는 역할을 합니다.
브로커는 여러 대의 서버로 구성 될 수 있고, 각 서버는 클러스터를 형성하여 높은 가용성과 확장성을 제공합니다.
브로커는 메시지를 토픽 단위로 관리하며, 각 토픽은 여러 파티션으로 나누어져 있습니다.

## 프로듀서
메시지를 생성하고 브로커에 전송하는 역할을 하는 모든 애플리케이션이나 서비스입니다.
프로듀서는 메시지를 특정 토픽에 발행하며, 메시지의 키와 값을 지정할 수 있습니다.

## 컨슈머
컨슈머는 브로커에서 메시지를 읽어오는(소비하는) 서비스입니다.
메시지를 읽을 때마다 파티션별로 offset을 갱신하여, 다음에 읽을 메시지의 위치를 추적합니다.

### 오프셋
오프셋은 각 파티션 내에서 메시지의 위치를 나타내는 고유한 숫자입니다.
컨슈머는 오프셋을 사용하여 자신이 읽은 마지막 메시지의 위치를 추적하고, 이후에 읽을 메시지를 결정합니다.
오프셋은 컨슈머 그룹 단위로 관리되며, 각 컨슈머 그룹은 독립적으로 오프셋을 유지합니다.


## 컨슈머 그룹
컨슈머 그룹은 하나의 토픽에 발행된 메세지를 
여러 서비스가 컨슘하기 위한 개념이며, 
보통 컨슈머그룹 하나에 하나의 서비스가 매핑됩니다.

## 토픽
토픽은 메시지를 분류하는 논리적인 단위고, N 개의 파티션으로 구성됩니다.

## 파티션
파티션은 토픽 내에서 메시지를 저장하는 물리적인 단위입니다.
전체 메세지 발행 순차처리를 보장하지않지만, 같은 파티션의 메세지에 대해서는 순차처리를 보장합니다.

동시성 제어의 개념을 생각햇을때, 동시에 처리되면 안되는 자원의 id 등을 메시지 키로 설정하면
순차처리가 보장되어야 하는 케이스는 보장도 되면서 병렬처리로 성능도 챙길 수 있습니다.

> 포인트 차감
> - 유저1,2,3의 포인트 충전&차감이 동시에 일어나도 되지만
> - 유저1의 포인트 충전&차감은 동시에 일어나면 안되죠.

아닌
