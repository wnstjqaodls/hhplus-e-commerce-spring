# 부하 테스트 계획서

## 1. 개요
온라인 쇼핑몰에서 새로운 기능을 출시하거나 대규모 이벤트를 진행할 때, 많은 사용자가 동시에 접속해도 서비스가 정상적으로 작동하는지 미리 확인하기 위해 부하 테스트를 진행합니다.

### 1.1 테스트 목적
- **성능 한계 확인**: 우리 시스템이 동시에 몇 명까지 처리할 수 있는지 파악
- **문제점 발견**: 시스템이 느려지거나 오류가 발생하는 원인 찾기
- **확장 가능성 검증**: 사용자가 늘어나면 시스템을 얼마나 더 키워야 하는지 계산
- **안정성 평가**: 많은 사용자가 몰려도 시스템이 멈추지 않는지 확인
- **서비스 품질 보장**: 빠른 응답속도와 낮은 오류율 목표 달성

## 2. 테스트 대상 API 선정

### 2.1 핵심 서비스 기능별 성능 목표
| 서비스 기능 | 초당 처리량 목표 | 응답시간 목표 | 중요도 |
|-------------|------------------|---------------|--------|
| 상품 목록 보기 | 100건/초 | 0.2초 이내 | 높음 |
| 상품 상세정보 보기 | 80건/초 | 0.1초 이내 | 높음 |
| 포인트 충전하기 | 50건/초 | 0.5초 이내 | 중요 |
| 포인트 잔액 확인하기 | 30건/초 | 0.1초 이내 | 중간 |
| 상품 주문 및 결제하기 | 20건/초 | 1초 이내 | 핵심 |
| 쿠폰 발급받기 | 100건/초 | 0.3초 이내 | 핵심 |

### 2.2 예상되는 문제 지점
1. **동시 처리 충돌**: 같은 사용자가 동시에 포인트 충전이나 주문을 할 때 발생할 수 있는 오류
2. **재고 관리**: 인기 상품에 주문이 몰릴 때 재고 수량이 정확히 차감되지 않는 문제
3. **쿠폰 발급 지연**: 선착순 쿠폰 이벤트 시 많은 사용자가 동시 신청할 때 발생하는 지연
4. **데이터베이스 연결 한계**: 동시 접속자가 많아지면 데이터베이스 연결이 부족해지는 문제
5. **임시 저장소 성능**: 빠른 처리를 위한 임시 저장소의 성능 한계

## 3. 테스트 환경 구성

### 3.1 테스트 인프라
- **테스트 도구**: k6 (JavaScript 기반 부하 테스트)
- **애플리케이션**: Spring Boot 3.4.1 (Java 17)
- **데이터베이스**: MySQL 8.0
- **캐시**: Redis 7.4.4
- **메시지 큐**: Apache Kafka (쿠폰 발급용)

### 3.2 시스템 리소스
- **CPU**: 현재 환경 기준 측정
- **Memory**: JVM 힙 메모리 모니터링
- **Network**: 로컬 테스트 (Docker 환경)
- **Storage**: MySQL 디스크 I/O 모니터링

## 4. 테스트 시나리오

### 4.1 Smoke Test (연기 테스트)
- **목적**: 기본 기능 동작 검증
- **부하**: 1-2명의 가상 사용자
- **지속시간**: 2분
- **검증**: 모든 API 정상 응답 확인

### 4.2 Load Test (부하 테스트)
- **목적**: 정상 운영 부하에서의 성능 측정
- **부하**: 10-50명의 가상 사용자
- **지속시간**: 10분
- **시나리오**: 일반적인 사용자 행동 패턴 시뮬레이션

### 4.3 Stress Test (스트레스 테스트)
- **목적**: 시스템 한계점 탐지
- **부하**: 50-200명까지 점진적 증가
- **지속시간**: 15분
- **검증**: 시스템 붕괴점 및 복구 능력 확인

### 4.4 Spike Test (스파이크 테스트)
- **목적**: 급격한 트래픽 증가 대응 능력 검증
- **부하**: 10명 → 100명 급증 → 10명 복귀
- **지속시간**: 5분
- **시나리오**: 플래시 세일, 이벤트 시작 상황 시뮬레이션

### 4.5 Peak Test (피크 테스트)
- **목적**: 최대 예상 부하에서의 성능 유지 검증
- **부하**: 100-150명 유지
- **지속시간**: 30분
- **검증**: 장시간 고부하 상황 안정성 확인

### 4.6 Volume Test (대용량 테스트)
- **목적**: 대량 데이터 처리 성능 검증
- **부하**: 50명 가상 사용자
- **지속시간**: 60분
- **특징**: 메모리 누수, 가비지 컬렉션 영향 관찰

## 5. 성능 목표 및 임계값

### 5.1 응답시간 목표 (SLA)
- **상품 조회**: 95% 요청이 200ms 이내
- **포인트 충전**: 95% 요청이 500ms 이내
- **주문 결제**: 95% 요청이 1000ms 이내
- **쿠폰 발급**: 95% 요청이 300ms 이내

### 5.2 처리량 목표
- **전체 TPS**: 최소 200 TPS 달성
- **에러율**: 1% 미만 유지
- **가용성**: 99.9% 이상

### 5.3 리소스 사용률 임계값
- **CPU 사용률**: 80% 이하
- **메모리 사용률**: 85% 이하
- **DB 커넥션**: 80% 이하
- **Redis 메모리**: 75% 이하

## 6. 테스트 실행 계획

### 6.1 테스트 순서
1. **환경 준비**: Docker Compose로 인프라 구성
2. **Smoke Test**: 기본 기능 검증
3. **Load Test**: 정상 부하 성능 측정
4. **Stress Test**: 한계점 탐지
5. **Spike Test**: 급증 부하 대응 검증
6. **Peak Test**: 지속 고부하 안정성 검증
7. **Volume Test**: 장기 안정성 검증

### 6.2 모니터링 항목
- **애플리케이션 메트릭**: 응답시간, 처리량, 에러율
- **시스템 메트릭**: CPU, 메모리, 네트워크, 디스크 I/O
- **데이터베이스 메트릭**: 커넥션 풀, 쿼리 실행시간, 락 대기
- **Redis 메트릭**: 메모리 사용률, 명령어 처리시간
- **비즈니스 메트릭**: 주문 성공률, 포인트 충전 성공률

## 7. 결과 분석 기준

### 7.1 성공 기준
- 모든 SLA 목표치 달성
- 시스템 크래시 또는 데이터 손실 없음
- 부하 종료 후 정상 복구 확인

### 7.2 분석 관점
- **성능 병목점**: 가장 느린 구간 식별
- **확장성**: 사용자 증가에 따른 성능 변화 패턴
- **안정성**: 고부하 상황에서의 에러 패턴 분석
- **복구력**: 부하 해제 후 시스템 정상화 시간

## 8. 위험 요소 및 대응 방안

### 8.1 예상 위험
- **데이터베이스 락 타임아웃**: 동시성 제어 로직 병목
- **메모리 부족**: JVM 힙 메모리 고갈
- **커넥션 풀 고갈**: DB 커넥션 부족
- **Redis 장애**: 분산 락 시스템 의존성

### 8.2 대응 방안
- **점진적 부하 증가**: 급격한 부하보다 단계적 증가
- **실시간 모니터링**: 임계치 도달 시 즉시 테스트 중단
- **롤백 계획**: 테스트 환경 초기화 스크립트 준비
- **데이터 백업**: 테스트 전 중요 데이터 백업



